# BCD_NTZ_SemiSupervisedCausal

This repository contains code, relevant files, and some additional supplementary results for the work
**Comparison of B-cell depletion versus natalizumab for treatment of multiple sclerosis: A semi-supervised causal analysis** from Dominic DiSanto, Weijing Tang PhD, Wen Zhu MD, Michele Morris BS, Shyam Visweswaran, MD, Tianxi Cai, ScD, Zongqi Xia, MD. 

A pre-print of this work is available at https://www.medrxiv.org/content/10.1101/2025.01.24.25321100v1. A compilation of the Tables and Figures of this work is included within this repository. 

Code contained under `Code/.` (not in sub-folders) is related to the construction of the BCD and NTZ analytic cohorts. Numbered files are interim programs called through the cohort construction. `00_shared_setup.R` is commonly called as a preamble to analytic files for loading of packages, setting of data-file paths. 

Code under `Code/PDDS_Imputation` includes generation of figures and results for models of ordinal PDDS score. These models were used to create covariates of disability risk using available data prior to and at 1-year after target treatment initiation. 

Code under `Code/analysis_scripts` includes 
- `00_causal_core_Robust_Perturbed.R` - Functions used to calculate ATE using the double-index propensity score (DiPS) method from Cheng (2020) (including underlying models)
- `01_analytic_wrangling.R` - Calculates relevant covariates for analysis, including countings of codified and narrative features (and updated utilization covariate to include narrative features)
- `01_analytic_wrangling_postDMT.R` - Re-calculates codified/narrative and clinical covariates using additiona, post-DMT initiation data based on the provided lookforward period. Post-DMT covariates are used in outcome imputation model fitting for semi-supervised analysis. 

For the generation of Tables, Figures, and Supplementary Results:     
- Code under `Code/Tables_Figures` used to generate Main and supplementary Tables and Figures, with the exception of Figure 1 
- Supplementary Figures 1-2, Tables 1ad-2 are generated and were exported from the results of `PDDS_Imputation/Imputation_Performance_KGclean.Rmd` 
- Supplementary Figures 2, 3ab and Supplementary Tables 6ab, 7 is additionally generated by `Tbl2_Main_ATE_Results.R` 
- Supplementary Tables 4a-c are created by `Tbl1_Fig2_CohortEstimateSummary.R`
- Supplementary Tables 5ab `SuppTbl_BalancedCovariates.R`
- Supplementary Tables 8ab are generated by `SuppTbl_ATE_PowerAnalyses.R`
